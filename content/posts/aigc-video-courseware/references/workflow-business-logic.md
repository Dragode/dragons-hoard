+++
date = '2026-02-07T15:29:04+08:00'
draft = false
title = '参考：AI课件工作流业务逻辑'
tags = ['AI', 'AIGC', 'Dify', '视频生成', '工作流']
categories = ['技术调研']
series = ['AIGC视频课件生成实践']
weight = 110
+++


## 整体概览

这是一个将**故事大纲**转化为**可播放视频课件**的自动化工作流，由两个子流程组成：

```
┌────────────────────────────────────────────────────────────────────────┐
│                        AI课件AIGC自动化工作流                            │
├────────────────────────────────────────────────────────────────────────┤
│                                                                        │
│   输入                                                                  │
│   ├── 剧本大纲（故事内容）                                               │
│   ├── 美术风格                                                          │
│   ├── 主体参考图（可选：角色/场景图片）                                    │
│   └── 自定义主体描述                                                     │
│                                                                        │
│   ┌─────────────────────────────────────────────────────────────┐      │
│   │           子流程1：主体素材生产                                │      │
│   │           (AIGC-主体素材生产.yml)                             │      │
│   └─────────────────────────────────────────────────────────────┘      │
│                              ↓                                         │
│                        主体资产库                                        │
│                    (角色/场景/道具图片)                                   │
│                              ↓                                         │
│   ┌─────────────────────────────────────────────────────────────┐      │
│   │           子流程2：故事演绎视频生成                            │      │
│   │   (AI课件-AIGC自动化工作流-故事演绎.yml)                       │      │
│   └─────────────────────────────────────────────────────────────┘      │
│                              ↓                                         │
│   输出                                                                  │
│   └── 剪映草稿（含视频/图片/字幕/配音）                                   │
│                                                                        │
└────────────────────────────────────────────────────────────────────────┘
```

---

## 子流程1：主体素材生产

**目标**：从剧本中识别所有视觉元素，生成统一风格的参考图

```
┌─────────────────────────────────────────────────────────────────────┐
│                         主体素材生产流程                               │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ① 输入解析                                                          │
│     ├── 剧本大纲                                                     │
│     ├── 美术风格（如：水墨风格、赛博朋克）                              │
│     └── 自定义主体图片 + 描述（可选）                                   │
│                                                                     │
│                        ↓                                            │
│                                                                     │
│  ② 剧本分析（LLM）                                                    │
│     │                                                               │
│     ├── 识别人物角色 (human_character)                                │
│     │   └── 提取：性别、年龄、外貌、服装、发型、标志物品                  │
│     │                                                               │
│     ├── 识别生物角色 (creature_character)                             │
│     │   └── 提取：物种、体型、外观、特殊特征                            │
│     │                                                               │
│     ├── 识别场景 (scene)                                              │
│     │   └── 提取：地点类型、环境描述、光线、氛围                         │
│     │                                                               │
│     └── 识别道具 (prop) - 仅核心道具                                   │
│         └── 条件：剧情关键 / 高频出现 / 视觉一致性要求高                  │
│                                                                     │
│                        ↓                                            │
│                                                                     │
│  ③ 视觉描述生成                                                       │
│     │                                                               │
│     ├── 人物：生成三视图描述（正面/侧面/背面）                           │
│     ├── 生物：生成物种原型描述（禁止拟人化）                             │
│     ├── 场景：生成空场景描述（禁止出现角色）                             │
│     └── 道具：生成单体描述                                             │
│                                                                     │
│                        ↓                                            │
│                                                                     │
│  ④ AI绘图（并行）                                                      │
│     │                                                               │
│     ├── 有参考图？                                                    │
│     │   ├── 是 → 直接使用参考图                                       │
│     │   └── 否 → 调用AI绘图                                          │
│     │                                                               │
│     └── 绘图引擎选择：                                                │
│         ├── 即梦（豆包）- 默认                                        │
│         └── 悠船（Midjourney）- 备选                                  │
│                                                                     │
│                        ↓                                            │
│                                                                     │
│  ⑤ 输出：主体资产库                                                    │
│     └── 每个资产包含：ID、类型、描述、参考图URL                          │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

### 关键业务规则

| 规则 | 说明 |
|------|------|
| **忠实还原** | 只提取剧本明确描述的元素，禁止联想创作 |
| **禁止拟人化** | 动物/生物保持原型，不穿衣服、不站立 |
| **场景无角色** | 场景图必须是"空场景"，不含任何角色剪影 |
| **风格统一** | 所有素材使用同一美术风格 |

---

## 子流程2：故事演绎视频生成

**目标**：基于主体资产库，将剧本转化为可播放的视频草稿

```
┌─────────────────────────────────────────────────────────────────────┐
│                      故事演绎视频生成流程                              │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ① 剧本创作（LLM）                                                    │
│     │                                                               │
│     ├── 原著核实：查询原典，补全遗漏情节                                │
│     ├── 内容考据：核实时代背景、服化道                                  │
│     ├── 剧本扩写：每个情节点展开为完整场景                              │
│     └── 输出：场景化剧本（含转场、台词、动作）                           │
│                                                                     │
│                        ↓                                            │
│                                                                     │
│  ② 分镜设计（LLM）                                                    │
│     │                                                               │
│     ├── 将场景拆分为镜头组（shot_groups）                               │
│     ├── 每个镜头定义：                                                │
│     │   ├── 景别（远景/全景/中景/近景/特写）                           │
│     │   ├── 机位角度（平视/俯拍/仰拍）                                 │
│     │   ├── 运镜方式（固定/缓推/横摇/跟拍）                             │
│     │   ├── 角色位置与动作                                            │
│     │   ├── 台词/旁白                                                │
│     │   └── 时长                                                     │
│     │                                                               │
│     └── 输出：分镜脚本（JSON格式）                                     │
│                                                                     │
│                        ↓                                            │
│                                                                     │
│  ③ 资产编排（LLM）                                                    │
│     │                                                               │
│     ├── 将分镜与主体资产库匹配                                         │
│     ├── 生成图像提示词 (image_prompt)                                 │
│     │   └── 整合：场景DNA + 景别 + 角色锚点 + 光影 + 构图               │
│     ├── 生成视频提示词 (video_prompt)                                 │
│     │   └── 整合：动作 + 运镜 + 配音模板                               │
│     └── 选择生成方案：                                                │
│         ├── i2v-single：静态镜头（1张图→视频）                         │
│         └── i2v-keyframe：动态镜头（2张图→视频）                        │
│                                                                     │
│                        ↓                                            │
│                                                                     │
│  ④ 故事板生成                                                         │
│     │                                                               │
│     └── 每个镜头组生成一张故事板图片                                    │
│         └── 用于后续生图时的构图参考                                   │
│                                                                     │
│                        ↓                                            │
│                                                                     │
│  ⑤ 分镜图片/视频生成（并行）                                           │
│     │                                                               │
│     ├── 每个镜头：                                                    │
│     │   ├── AI生图（即梦/Gemini）                                     │
│     │   └── AI生视频（图生视频）                                       │
│     │                                                               │
│     └── 输出：镜头素材列表                                             │
│         └── 每个镜头：图片URL、视频URL、字幕、时长                       │
│                                                                     │
│                        ↓                                            │
│                                                                     │
│  ⑥ 剪映草稿合成                                                       │
│     │                                                               │
│     ├── 创建草稿（设置画布尺寸）                                        │
│     ├── 批量添加视频/图片（按时间线排列）                                │
│     ├── 批量添加字幕（同步时间轴）                                      │
│     └── 批量添加音频（TTS配音）                                        │
│                                                                     │
│                        ↓                                            │
│                                                                     │
│  ⑦ 输出                                                               │
│     ├── 剪映草稿URL（可在剪映打开编辑）                                  │
│     └── 分镜数据（story_board JSON）                                   │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 核心业务概念

### 1. 主体资产 (Assets)

| 类型 | 说明 | 示例 |
|------|------|------|
| human_character | 人类角色 | 刘备、诸葛亮、小女孩 |
| creature_character | 非人类角色 | 龙、猫、机器人 |
| scene | 场景环境 | 书房、森林、城堡 |
| prop | 核心道具 | 魔法戒指、藏宝图 |

### 2. 分镜术语

| 术语 | 说明 |
|------|------|
| shot_group | 镜头组（同一场景的多个镜头） |
| scene_dna | 场景DNA（场景共享的视觉设定） |
| character_anchor | 角色锚点（角色首次出场时的视觉锚定） |
| prompt_prefix | 场景前缀（强制放在提示词开头） |

### 3. 视频生成方案

| 方案 | 输入 | 适用场景 |
|------|------|---------|
| i2v-single | 1张图片 | 对话镜头、静态镜头、循环动作 |
| i2v-keyframe | 2张图片（首帧+尾帧） | 位置移动、姿态变化、表情转变 |

### 4. 配音类型

| 类型 | 说明 |
|------|------|
| dialogue | 角色对话 |
| voiceover | 画外音 |
| narrator | 旁白 |
| inner | 内心独白 |
| sound | 音效（如"噗"、"咔嚓"等拟声词） |
| (空) | 无配音 |

### 5. 风格适配 (style_adaptations)

每个镜头可以包含针对美术风格的细化适配参数：

| 参数 | 说明 | 示例 |
|------|------|------|
| camera_work | 镜头处理 | 静帧画面，如同翻页 |
| lighting | 光线效果 | 柔和的金色晨光，无强烈阴影 |
| color_grade | 色彩调性 | 水彩质感的温暖色调 |
| composition | 构图方式 | 前景画框构图, 远景 |
| texture | 画面质感 | 手绘轮廓，纸张纹理，水彩笔触 |
| environment_dynamics | 环境动态 | 光尘漂浮，露珠晶莹 |

### 6. 镜头连续性控制

| 字段 | 说明 |
|------|------|
| continuity_note | 连续性备注，确保镜头间的视觉一致性 |
| visible_fixed_elements | 画面中固定可见的元素列表 |
| characters_in_frame | 当前镜头中出现的角色列表 |

### 7. 镜头情绪与动态

| 字段 | 说明 | 可选值示例 |
|------|------|-----------|
| motion_intensity | 动态强度 | low / medium / high |
| emotion_tone | 情绪基调 | hopeful / mysterious / joyful / tense |
| scene_type | 场景类型 | interior / exterior / fantasy |

---

## 简化的端到端流程

```
故事大纲 + 美术风格
        ↓
    ┌───────────┐
    │ 主体识别   │ → 识别角色、场景、道具
    └───────────┘
        ↓
    ┌───────────┐
    │ AI绘图    │ → 生成主体参考图
    └───────────┘
        ↓
    ┌───────────┐
    │ 剧本扩写   │ → 补全情节，场景化
    └───────────┘
        ↓
    ┌───────────┐
    │ 分镜设计   │ → 拆分镜头，定义视觉参数
    └───────────┘
        ↓
    ┌───────────┐
    │ AI生图/视频│ → 批量生成分镜素材
    └───────────┘
        ↓
    ┌───────────┐
    │ 视频合成   │ → 剪映草稿（图片+视频+字幕）
    └───────────┘
        ↓
    剪映草稿URL
```

---

## 分镜输出数据结构

每个分镜输出包含以下核心字段：

```
┌─────────────────────────────────────────────────────────────────────┐
│                          分镜数据结构                                │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  基础信息                                                           │
│  ├── idx                    镜头序号                                │
│  ├── description            镜头描述                                │
│  ├── style                  美术风格                                │
│  └── video_duration         视频时长                                │
│                                                                     │
│  资产引用                                                           │
│  ├── ref_assets             引用的主体资产ID列表                     │
│  ├── characters_in_frame    画面中的角色列表                         │
│  └── visible_fixed_elements 画面中的固定元素                         │
│                                                                     │
│  生成参数                                                           │
│  ├── generation_method      生成方案 (i2v-single/i2v-keyframe)      │
│  ├── image_prompt           首帧图像提示词                           │
│  ├── image_prompt_end       尾帧图像提示词 (仅keyframe)              │
│  └── video_prompt           视频动态提示词                           │
│                                                                     │
│  镜头语言                                                           │
│  ├── shot_type              景别 (远景/全景/中景/近景/特写)          │
│  ├── camera_angle           机位角度                                │
│  ├── camera_movement        运镜方式                                │
│  ├── composition            构图方式                                │
│  └── action                 角色动作描述                            │
│                                                                     │
│  情绪与氛围                                                         │
│  ├── scene_type             场景类型 (interior/exterior/fantasy)    │
│  ├── motion_intensity       动态强度 (low/medium/high)              │
│  └── emotion_tone           情绪基调                                │
│                                                                     │
│  配音信息                                                           │
│  ├── narration              配音文本                                │
│  ├── narration_type         配音类型                                │
│  ├── narrator               配音角色/旁白者                          │
│  └── voice_desc             音色描述                                │
│                                                                     │
│  风格适配 (style_adaptations)                                       │
│  ├── camera_work            镜头处理                                │
│  ├── lighting               光线效果                                │
│  ├── color_grade            色彩调性                                │
│  ├── composition            构图细化                                │
│  ├── texture                画面质感                                │
│  └── environment_dynamics   环境动态                                │
│                                                                     │
│  连续性控制                                                         │
│  └── continuity_note        镜头间连续性备注                         │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 数据流转示意

```
                                    ┌─────────────────┐
                                    │    用户输入      │
                                    │  ─────────────  │
                                    │  · 故事大纲     │
                                    │  · 美术风格     │
                                    │  · 参考图(可选)  │
                                    └────────┬────────┘
                                             │
                 ┌───────────────────────────┼───────────────────────────┐
                 │                           ▼                           │
                 │              ┌─────────────────────────┐              │
                 │              │      主体素材生产        │              │
                 │              └─────────────────────────┘              │
                 │                           │                           │
                 │              ┌────────────┴────────────┐              │
                 │              ▼                         ▼              │
                 │    ┌─────────────────┐      ┌─────────────────┐      │
                 │    │   剧本分析      │      │   风格提示词     │      │
                 │    │   (识别主体)    │      │   生成          │      │
                 │    └────────┬────────┘      └────────┬────────┘      │
                 │             │                        │               │
                 │             └───────────┬────────────┘               │
                 │                         ▼                            │
                 │              ┌─────────────────────────┐              │
                 │              │     AI绘图 (并行)       │              │
                 │              │  ───────────────────   │              │
                 │              │  即梦 / 悠船 / Gemini   │              │
                 │              └────────────┬───────────┘              │
                 │                           │                          │
                 │                           ▼                          │
                 │              ┌─────────────────────────┐              │
                 │              │      主体资产库         │              │
                 │              │  ───────────────────   │              │
                 │              │  [{id, type, url}...]  │              │
                 │              └────────────┬───────────┘              │
                 │                           │                          │
                 └───────────────────────────┼──────────────────────────┘
                                             │
                 ┌───────────────────────────┼───────────────────────────┐
                 │                           ▼                           │
                 │              ┌─────────────────────────┐              │
                 │              │     故事演绎视频生成     │              │
                 │              └─────────────────────────┘              │
                 │                           │                           │
                 │    ┌──────────────────────┼──────────────────────┐    │
                 │    ▼                      ▼                      ▼    │
                 │ ┌────────┐          ┌──────────┐          ┌────────┐ │
                 │ │剧本创作│          │ 分镜设计 │          │资产编排│ │
                 │ └───┬────┘          └────┬─────┘          └───┬────┘ │
                 │     │                    │                    │      │
                 │     └────────────────────┼────────────────────┘      │
                 │                          ▼                           │
                 │              ┌─────────────────────────┐              │
                 │              │   分镜图片/视频生成      │              │
                 │              │      (并行遍历)         │              │
                 │              └────────────┬───────────┘              │
                 │                           │                          │
                 │                           ▼                          │
                 │              ┌─────────────────────────┐              │
                 │              │     剪映草稿合成        │              │
                 │              │  ───────────────────   │              │
                 │              │  · 添加视频/图片       │              │
                 │              │  · 添加字幕           │              │
                 │              │  · 添加音频           │              │
                 │              └────────────┬───────────┘              │
                 │                           │                          │
                 └───────────────────────────┼──────────────────────────┘
                                             │
                                             ▼
                                    ┌─────────────────┐
                                    │    最终输出      │
                                    │  ─────────────  │
                                    │  · 剪映草稿URL  │
                                    │  · 分镜数据JSON │
                                    └─────────────────┘
```

---

## 输出示例

### 剪映草稿URL格式

```
https://ts.fyshark.com/#/cozeToJianyin?drafId={草稿ID}
```

用户可直接在剪映客户端中打开此URL进行后续编辑。

### story_board 数据示例

```json
{
  "idx": 1,
  "description": "清晨的花园，露珠在阳光下闪烁",
  "style": "水彩童话风格",
  "ref_assets": ["scene_garden", "char_thumbelina"],
  "generation_method": "i2v-single",
  "image_prompt": "水彩童话风格，清晨花园全景，...",
  "video_prompt": "镜头缓缓推近，露珠微微晃动",
  "video_duration": 5,
  "shot_type": "全景",
  "camera_movement": "缓推",
  "motion_intensity": "low",
  "emotion_tone": "hopeful",
  "narration": "在一个美丽的花园里...",
  "narration_type": "narrator",
  "style_adaptations": {
    "camera_work": "静帧画面，如同翻页",
    "lighting": "柔和的金色晨光",
    "color_grade": "水彩质感的温暖色调",
    "texture": "手绘轮廓，纸张纹理"
  }
}
```
