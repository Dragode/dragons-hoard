+++
date = '2026-01-25T00:00:00+08:00'
draft = false
title = 'LangGraph A2A åè®® vs Thread/Assistant API æ·±åº¦å¯¹æ¯”åˆ†æ'
tags = ['LangGraph', 'A2A', 'Dify', 'API', 'HITL']
categories = ['æŠ€æœ¯è°ƒç ”']
+++

> è°ƒç ”æ—¶é—´ï¼š2026-01-25
> è°ƒç ”ç›®çš„ï¼šè¯„ä¼° Dify å¯¹æ¥ LangGraph æ—¶ï¼Œä½¿ç”¨ A2A åè®®æ˜¯å¦èƒ½æ›¿ä»£ç°æœ‰ Thread API æ–¹æ¡ˆ

---

## æ ¸å¿ƒç»“è®º

### ä¸€å¥è¯ç»“è®º

> **A2A åè®®æ— æ³•å®Œæ•´è¡¨è¾¾ LangGraph æ‰€æœ‰èƒ½åŠ›ï¼Œä¸å»ºè®®ä½œä¸º Dify å¯¹æ¥ LangGraph çš„é¦–é€‰æ–¹æ¡ˆã€‚**

### ç»“è®ºè¦ç‚¹

| ç»´åº¦ | ç»“è®º |
|------|------|
| **èƒ½åŠ›è¦†ç›–** | A2A ä»…è¦†ç›– Thread API **30-40%** çš„æ ¸å¿ƒèƒ½åŠ›ï¼ˆ3 ä¸ªæ–¹æ³• vs 35+ ç«¯ç‚¹ï¼‰ |
| **åè®®å®šä½** | A2A æ˜¯é¢å‘**è·¨å¹³å° Agent äº’æ“ä½œ**çš„æ ‡å‡†åŒ–åè®®ï¼Œéå†…éƒ¨ç³»ç»Ÿé›†æˆæ–¹æ¡ˆ |
| **å…³é”®ç¼ºå¤±** | çŠ¶æ€è¯»å†™ã€æ—¶é—´æ—…è¡Œã€é™æ€ä¸­æ–­ç‚¹ã€å¤šç§æµå¼æ¨¡å¼ã€Store API ç­‰å‡ä¸æ”¯æŒ |
| **è¿ç§»å»ºè®®** | **ç»§ç»­ä½¿ç”¨ Thread API**ï¼Œä»…åœ¨éœ€è¦å¯¹å¤–æš´éœ²æ ‡å‡†åŒ–å…¥å£æ—¶ä½¿ç”¨ A2A |

### èƒ½åŠ›å·®å¼‚é€Ÿè§ˆ

```
Thread/Assistant API          A2A åè®®
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ… 35+ API ç«¯ç‚¹               âŒ ä»… 3 ä¸ªæ–¹æ³•
âœ… 6 ç§æµå¼æ¨¡å¼               âš ï¸ ä»… SSE
âœ… å®Œæ•´çŠ¶æ€è¯»å†™               âŒ ä¸æ”¯æŒ
âœ… æ£€æŸ¥ç‚¹/æ—¶é—´æ—…è¡Œ            âŒ ä¸æ”¯æŒ
âœ… é™æ€ä¸­æ–­ç‚¹ (before/after)  âŒ ä¸æ”¯æŒ
âœ… Store è·¨çº¿ç¨‹å­˜å‚¨           âŒ ä¸æ”¯æŒ
âœ… Run ç®¡ç† (å–æ¶ˆ/åˆ—è¡¨)       âŒ ä¸æ”¯æŒ
âœ… Cron å®šæ—¶ä»»åŠ¡              âŒ ä¸æ”¯æŒ
```

### æ¨èæ–¹æ¡ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ¨èï¼šç»§ç»­ä½¿ç”¨ Thread API                                    â”‚
â”‚                                                             â”‚
â”‚  Dify HTTP Node â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> LangGraph Thread API            â”‚
â”‚                   ï¼ˆä¿æŒå®Œæ•´èƒ½åŠ›ï¼‰                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¯é€‰ï¼šæ··åˆæ¨¡å¼ï¼ˆæœªæ¥æ‰©å±•ï¼‰                                    â”‚
â”‚                                                             â”‚
â”‚  å¤–éƒ¨ç³»ç»Ÿ â”€â”€â”€â”€ A2A åè®® â”€â”€â”€â”€> LangGraphï¼ˆæ ‡å‡†åŒ–å…¥å£ï¼‰         â”‚
â”‚  Dify     â”€â”€â”€â”€ Thread API â”€â”€> LangGraphï¼ˆå®Œæ•´èƒ½åŠ›ï¼‰          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¸€ã€è°ƒç ”èƒŒæ™¯

### 1.1 å½“å‰æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      HTTP Request       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Dify   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚   LangGraph     â”‚
â”‚ (ç¼–æ’å±‚) â”‚      Thread API         â”‚   (Agent å±‚)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 æ ¸å¿ƒé—®é¢˜

- A2A åè®®èƒ½å¦å®Œæ•´è¡¨è¾¾ LangGraph æ‰€æœ‰èƒ½åŠ›ï¼Ÿ
- åˆ‡æ¢åˆ° A2A æ˜¯å¦ä¼šå½±å“ç°æœ‰ä¸šåŠ¡ Agent çš„èƒ½åŠ›è¡¨è¾¾ï¼Ÿ
- A2A æ˜¯å¦æ˜¯æ›´å®Œå–„ã€æ›´å…·æ‰©å±•æ€§çš„æ–¹æ¡ˆï¼Ÿ

---

## äºŒã€èƒ½åŠ›å¯¹æ¯”æ€»è§ˆ

### 2.1 API ç«¯ç‚¹æ•°é‡å¯¹æ¯”

| ç±»åˆ« | Thread/Run API | A2A API |
|------|----------------|---------|
| Thread æ“ä½œ | 15+ ç«¯ç‚¹ | 1 ç«¯ç‚¹ |
| Run æ“ä½œ | 10+ ç«¯ç‚¹ | (åŒ…å«åœ¨ä¸Šè¿°ç«¯ç‚¹) |
| A2A æ“ä½œ | - | 1 ç«¯ç‚¹ï¼ˆ3 ä¸ªæ–¹æ³•ï¼‰ |
| Store æ“ä½œ | 5+ ç«¯ç‚¹ | æ—  |
| Cron æ“ä½œ | 4 ç«¯ç‚¹ | æ—  |
| **æ€»è®¡** | **35+ ç«¯ç‚¹** | **1 ç«¯ç‚¹** |

### 2.2 åŠŸèƒ½è¦†ç›–å¯¹æ¯”

| åŠŸèƒ½ | Thread API | A2A åè®® | å·®å¼‚è¯´æ˜ |
|------|------------|----------|----------|
| åˆ›å»ºå¯¹è¯ | âœ… POST /threads | âœ… è‡ªåŠ¨åˆ›å»º (contextId) | A2A é€šè¿‡é¦–æ¬¡æ¶ˆæ¯è‡ªåŠ¨åˆ›å»º |
| å‘é€æ¶ˆæ¯ | âœ… POST /threads/{id}/runs | âœ… message/send | åŸºæœ¬ç­‰æ•ˆ |
| æµå¼å“åº” | âœ… POST /runs/stream | âœ… message/stream | åŸºæœ¬ç­‰æ•ˆ |
| è·å–ä»»åŠ¡çŠ¶æ€ | âœ… GET /runs/{id} | âœ… tasks/get | åŸºæœ¬ç­‰æ•ˆ |
| **è·å–å¯¹è¯çŠ¶æ€** | âœ… GET /threads/{id}/state | âŒ æ—  | **é‡è¦å·®å¼‚** |
| **æ›´æ–°å¯¹è¯çŠ¶æ€** | âœ… POST /threads/{id}/state | âŒ æ—  | **é‡è¦å·®å¼‚** |
| **è·å–å†å²è®°å½•** | âœ… GET /threads/{id}/history | âŒ æ—  | **é‡è¦å·®å¼‚** |
| **æ£€æŸ¥ç‚¹æ—¶é—´æ—…è¡Œ** | âœ… GET /state/{checkpoint_id} | âŒ æ—  | **é‡è¦å·®å¼‚** |
| **ä¸­æ–­å‰ç½®** | âœ… interrupt_before | âŒ æ—  | **é‡è¦å·®å¼‚** |
| **ä¸­æ–­åç½®** | âœ… interrupt_after | âŒ æ—  | **é‡è¦å·®å¼‚** |
| **æ¢å¤æ‰§è¡Œ** | âœ… Command(resume=...) | âš ï¸ é€šè¿‡ input-required çŠ¶æ€ | èƒ½åŠ›å—é™ |
| å–æ¶ˆæ‰§è¡Œ | âœ… POST /runs/{id}/cancel | âš ï¸ tasks/cancel (å¯èƒ½ä¸æ”¯æŒ) | èƒ½åŠ›å—é™ |
| æœç´¢å¯¹è¯ | âœ… POST /threads/search | âŒ æ—  | Thread API ç‹¬æœ‰ |
| é•¿æœŸå­˜å‚¨ | âœ… Store API | âŒ æ—  | Thread API ç‹¬æœ‰ |
| å®šæ—¶ä»»åŠ¡ | âœ… Cron API | âŒ æ—  | Thread API ç‹¬æœ‰ |

### 2.3 æµå¼æ¨¡å¼å¯¹æ¯”

| æµå¼æ¨¡å¼ | Thread API | A2A åè®® | è¯´æ˜ |
|----------|------------|----------|------|
| values | âœ… | âŒ | æ¯æ­¥å®Œæ•´çŠ¶æ€ |
| updates | âœ… | âŒ | å¢é‡æ›´æ–° |
| messages-tuple | âœ… | âŒ | æ¶ˆæ¯å…ƒç»„æ ¼å¼ |
| debug | âœ… | âŒ | è°ƒè¯•ä¿¡æ¯ |
| custom | âœ… | âŒ | è‡ªå®šä¹‰äº‹ä»¶ |
| events | âœ… | âŒ | LangChain å›è°ƒäº‹ä»¶ |
| SSE | âœ… | âœ… | A2A ä»…æ”¯æŒæ­¤æ¨¡å¼ |

---

## ä¸‰ã€å…³é”®å·®å¼‚è¯¦ç»†åˆ†æ

### 3.1 Human-in-the-Loop (HITL) èƒ½åŠ›

**Thread API çš„ HITL å®ç°ï¼š**

```python
# 1. åˆ›å»ºè¿è¡Œæ—¶æŒ‡å®šä¸­æ–­ç‚¹
result = await client.runs.wait(
    thread_id,
    assistant_id,
    input={"text": "éœ€è¦å¤„ç†çš„å†…å®¹"},
    interrupt_before=["human_review_node"],  # åœ¨æŒ‡å®šèŠ‚ç‚¹å‰ä¸­æ–­
    interrupt_after=["sensitive_action"]      # åœ¨æŒ‡å®šèŠ‚ç‚¹åä¸­æ–­
)

# 2. æ£€æŸ¥æ˜¯å¦ä¸­æ–­
if result.status == "interrupted":
    # è·å–å½“å‰çŠ¶æ€ä¾›äººå·¥å®¡æ ¸
    state = await client.threads.get_state(thread_id)

    # äººå·¥å®¡æ ¸åæ¢å¤æ‰§è¡Œ
    await client.runs.wait(
        thread_id,
        assistant_id,
        command=Command(resume="å®¡æ ¸é€šè¿‡ï¼Œç»§ç»­æ‰§è¡Œ")
    )
```

**A2A çš„ HITL å®ç°ï¼š**

```python
# A2A é€šè¿‡ input-required çŠ¶æ€å®ç°
# ä½†ç¼ºå°‘ interrupt_before/after çš„ç²¾ç»†æ§åˆ¶

# å‘é€æ¶ˆæ¯
response = a2a_client.send_message({
    "role": "user",
    "parts": [{"kind": "text", "text": "å¤„ç†è¯·æ±‚"}]
})

# å¦‚æœ Agent éœ€è¦æ›´å¤šè¾“å…¥
if response["status"]["state"] == "input-required":
    # ç”¨æˆ·æä¾›é¢å¤–è¾“å…¥
    response = a2a_client.send_message({
        "role": "user",
        "parts": [{"kind": "text", "text": "è¡¥å……ä¿¡æ¯"}],
        "contextId": response["contextId"],
        "taskId": response["id"]
    })
```

**å·®å¼‚æ€»ç»“ï¼š**

| ç»´åº¦ | Thread API | A2A |
|------|------------|-----|
| ä¸­æ–­ç‚¹æ§åˆ¶ | å¯æŒ‡å®šä»»æ„èŠ‚ç‚¹ | ä»… Agent è‡ªä¸»å†³å®š |
| ä¸­æ–­æ—¶æœº | before/after ç²¾ç¡®æ§åˆ¶ | æ— æ³•ç²¾ç¡®æ§åˆ¶ |
| çŠ¶æ€å¯è§æ€§ | å®Œæ•´çŠ¶æ€å¯è®¿é—® | ä»…çœ‹åˆ° Agent è¾“å‡º |
| æ¢å¤æ–¹å¼ | Command å¯¹è±¡ï¼Œæ”¯æŒå¤æ‚æ•°æ® | çº¯æ¶ˆæ¯å½¢å¼ |

### 3.2 çŠ¶æ€ç®¡ç†ä¸æ£€æŸ¥ç‚¹

**Thread API çŠ¶æ€ç®¡ç†ï¼š**

```python
# è·å–å®Œæ•´çŠ¶æ€
state = await client.threads.get_state(thread_id)
print(state.values)  # æ‰€æœ‰çŠ¶æ€å˜é‡
print(state.tasks)   # ä»»åŠ¡åˆ—è¡¨
print(state.next)    # ä¸‹ä¸€æ­¥èŠ‚ç‚¹

# æ›´æ–°çŠ¶æ€ï¼ˆå¤–éƒ¨æ³¨å…¥æ•°æ®ï¼‰
await client.threads.update_state(
    thread_id,
    values={"user_context": {"preference": "ä¸­æ–‡"}},
    as_node="context_injector"  # ä¼ªè£…ä¸ºæŸèŠ‚ç‚¹çš„è¾“å‡º
)

# æ£€æŸ¥ç‚¹æ—¶é—´æ—…è¡Œ
history = await client.threads.get_history(thread_id)
old_state = await client.threads.get_state(
    thread_id,
    checkpoint_id=history[5].checkpoint_id  # å›åˆ°ç¬¬5ä¸ªæ£€æŸ¥ç‚¹
)
```

**A2A çŠ¶æ€ç®¡ç†ï¼š**

```python
# A2A æ— æ³•ç›´æ¥è®¿é—®æˆ–æ“ä½œçŠ¶æ€
# åªèƒ½é€šè¿‡æ¶ˆæ¯é—´æ¥å½±å“

# æ— æ³•è·å–å†…éƒ¨çŠ¶æ€
# æ— æ³•æ³¨å…¥ä¸Šä¸‹æ–‡
# æ— æ³•è¿›è¡Œæ—¶é—´æ—…è¡Œ
```

**å·®å¼‚å½±å“ï¼š**
- æ— æ³•åœ¨ Dify å±‚é¢ç»´æŠ¤å’Œæ“ä½œ LangGraph çš„çŠ¶æ€
- æ— æ³•å®ç°"å›é€€åˆ°æŸä¸ªèŠ‚ç‚¹é‡æ–°æ‰§è¡Œ"çš„åŠŸèƒ½
- æ— æ³•ä»å¤–éƒ¨æ³¨å…¥ä¸Šä¸‹æ–‡æ•°æ®

### 3.3 ID æ˜ å°„å…³ç³»

| Thread API | A2A åè®® | è¯´æ˜ |
|------------|----------|------|
| thread_id | contextId | å¯¹è¯/ä¼šè¯æ ‡è¯† |
| run_id | taskId | å•æ¬¡æ‰§è¡Œæ ‡è¯† |
| checkpoint_id | æ— å¯¹åº” | A2A ä¸æš´éœ²æ£€æŸ¥ç‚¹ |
| assistant_id | åŒ…å«åœ¨ URL ä¸­ | `/a2a/{assistant_id}` |

---

## å››ã€æ¶æ„è®¾è®¡å“²å­¦å·®å¼‚

### 4.1 Thread API è®¾è®¡ç†å¿µ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å®Œå…¨æ§åˆ¶èŒƒå¼                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ æš´éœ²å†…éƒ¨çŠ¶æ€ï¼Œæ”¯æŒç»†ç²’åº¦æ“ä½œ                           â”‚
â”‚  â€¢ é€‚åˆï¼šå†…éƒ¨ç³»ç»Ÿé›†æˆã€éœ€è¦æ·±åº¦æ§åˆ¶çš„åœºæ™¯                  â”‚
â”‚  â€¢ ç±»æ¯”ï¼šåƒæ“ä½œæ•°æ®åº“ï¼Œæœ‰å®Œæ•´çš„ CRUD                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 A2A åè®®è®¾è®¡ç†å¿µ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    é»‘ç›’åä½œèŒƒå¼                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ éšè—å†…éƒ¨å®ç°ï¼Œä»…æš´éœ²æ¶ˆæ¯æ¥å£                           â”‚
â”‚  â€¢ é€‚åˆï¼šè·¨ç»„ç»‡ Agent åä½œã€æ¾è€¦åˆé›†æˆ                     â”‚
â”‚  â€¢ ç±»æ¯”ï¼šåƒè°ƒç”¨å¤–éƒ¨æœåŠ¡ï¼Œåªæœ‰ API å¥‘çº¦                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3 é€‚ç”¨åœºæ™¯å¯¹æ¯”

| åœºæ™¯ | æ¨èæ–¹æ¡ˆ | åŸå›  |
|------|----------|------|
| Dify è°ƒç”¨å†…éƒ¨ LangGraph Agent | Thread API | éœ€è¦çŠ¶æ€å¯è§æ€§å’Œæ§åˆ¶åŠ› |
| è·¨å…¬å¸ Agent åä½œ | A2A | äº’æ“ä½œæ€§ï¼Œä¸æš´éœ²å†…éƒ¨å®ç° |
| äººå·¥å®¡æ ¸æµç¨‹ | Thread API | éœ€è¦ interrupt_before/after |
| ç®€å•é—®ç­” Agent | A2A | æ¶ˆæ¯æ¨¡å¼è¶³å¤Ÿ |
| å¤æ‚å·¥ä½œæµç¼–æ’ | Thread API | éœ€è¦çŠ¶æ€æ³¨å…¥å’Œæ£€æŸ¥ç‚¹ |
| Agent å¸‚åœº/ç”Ÿæ€ | A2A | æ ‡å‡†åŒ–æ¥å£ä¾¿äºå‘ç°å’Œæ¥å…¥ |

---

## äº”ã€Dify å¯¹æ¥æ–¹æ¡ˆè¯„ä¼°

### 5.1 å½“å‰ Thread API æ–¹æ¡ˆçš„èƒ½åŠ›

```python
# Dify HTTP è¯·æ±‚èŠ‚ç‚¹å¯ä»¥å®ç°ï¼š

# 1. åˆ›å»ºå¯¹è¯
POST /threads

# 2. æ‰§è¡Œ Agentï¼ˆæ”¯æŒæµå¼ï¼‰
POST /threads/{thread_id}/runs/stream
{
    "assistant_id": "agent-xxx",
    "input": {"messages": [...]},
    "interrupt_before": ["human_check"],  # âœ… æ”¯æŒ
    "config": {...}
}

# 3. è·å–çŠ¶æ€ï¼ˆç”¨äºæ˜¾ç¤ºæˆ–è°ƒè¯•ï¼‰
GET /threads/{thread_id}/state

# 4. äººå·¥ä»‹å…¥åæ¢å¤
POST /threads/{thread_id}/runs/stream
{
    "command": {"resume": "approved"}  # âœ… æ”¯æŒ
}
```

### 5.2 åˆ‡æ¢åˆ° A2A åçš„èƒ½åŠ›æŸå¤±

| ç°æœ‰èƒ½åŠ› | A2A åçŠ¶æ€ | ä¸šåŠ¡å½±å“ |
|----------|-----------|----------|
| interrupt_before/after | âŒ ä¸¢å¤± | æ— æ³•åœ¨æŒ‡å®šèŠ‚ç‚¹æš‚åœç­‰å¾…äººå·¥å®¡æ ¸ |
| çŠ¶æ€è·å–/æ›´æ–° | âŒ ä¸¢å¤± | æ— æ³•ä» Dify ä¾§æŸ¥çœ‹æˆ–ä¿®æ”¹ Agent å†…éƒ¨çŠ¶æ€ |
| æ£€æŸ¥ç‚¹å›é€€ | âŒ ä¸¢å¤± | æ— æ³•å®ç°"æ’¤é”€åˆ°ä¸Šä¸€æ­¥"åŠŸèƒ½ |
| æœç´¢å¯¹è¯ | âŒ ä¸¢å¤± | æ— æ³•æŒ‰æ¡ä»¶æŸ¥è¯¢å†å²å¯¹è¯ |
| å®šæ—¶ä»»åŠ¡ | âŒ ä¸¢å¤± | æ— æ³•è®¾ç½® Agent å®šæ—¶æ‰§è¡Œ |

### 5.3 A2A çš„æ½œåœ¨ä¼˜åŠ¿ï¼ˆå¯¹ Dify åœºæ™¯ï¼‰

| ä¼˜åŠ¿ | è¯´æ˜ | Dify æ˜¯å¦éœ€è¦ |
|------|------|--------------|
| è·¨æ¡†æ¶äº’æ“ä½œ | å¯æ¥å…¥é LangGraph çš„ Agent | âš ï¸ è§†ä¸šåŠ¡è§„åˆ’ |
| Agent å‘ç° | é€šè¿‡ Agent Card è‡ªåŠ¨å‘ç°èƒ½åŠ› | âš ï¸ è§†ä¸šåŠ¡è§„åˆ’ |
| æ ‡å‡†åŒ–åè®® | Linux Foundation æ ‡å‡† | âš ï¸ é•¿æœŸä»·å€¼ |

---

## å…­ã€é£é™©è¯„ä¼°

### 6.1 è¿ç§»åˆ° A2A çš„é£é™©

| é£é™©é¡¹ | ä¸¥é‡ç¨‹åº¦ | è¯´æ˜ |
|--------|----------|------|
| æµå¼æ¨¡å¼é™çº§ | ğŸŸ¡ ä¸­ | å¦‚ä¸šåŠ¡ä¾èµ– `debug` æˆ– `events` æ¨¡å¼ï¼Œå°†æ— æ³•ä½¿ç”¨ |
| çŠ¶æ€æ“ä½œä¸¢å¤± | ğŸ”´ é«˜ | å¦‚ä¸šåŠ¡éœ€è¦è¯»å–/ä¿®æ”¹å›¾çŠ¶æ€ï¼ŒA2A æ— æ³•æ»¡è¶³ |
| HITL èƒ½åŠ›å—é™ | ğŸ”´ é«˜ | ç°æœ‰äººå·¥å®¡æ ¸æµç¨‹å°†æ— æ³•å·¥ä½œ |
| æ—¶é—´æ—…è¡Œä¸å¯ç”¨ | ğŸŸ¡ ä¸­ | æ— æ³•å›æº¯å†å²çŠ¶æ€è¿›è¡Œè°ƒè¯•æˆ–å›æ»š |
| å­å›¾äº‹ä»¶ä¸¢å¤± | ğŸŸ¡ ä¸­ | å¤æ‚å¤šå›¾æ¶æ„æ— æ³•è®¢é˜…å­å›¾æµå¼äº‹ä»¶ |
| Store ä¸å¯ç”¨ | ğŸŸ¡ ä¸­ | è·¨çº¿ç¨‹æŒä¹…åŒ–å­˜å‚¨éœ€è¦é¢å¤–æ–¹æ¡ˆ |

### 6.2 è¿ç§»æ£€æŸ¥æ¸…å•

å¦‚è€ƒè™‘ä½¿ç”¨ A2Aï¼Œè¯·é€é¡¹ç¡®è®¤ç°æœ‰ä¸šåŠ¡æ˜¯å¦ä¾èµ–ä»¥ä¸‹èƒ½åŠ›ï¼š

- [ ] å¤šç§æµå¼æ¨¡å¼ï¼ˆé SSEï¼‰
- [ ] ç›´æ¥è¯»å–å›¾çŠ¶æ€
- [ ] ä¿®æ”¹ä¸­é—´çŠ¶æ€
- [ ] æ£€æŸ¥ç‚¹/æ—¶é—´æ—…è¡Œ
- [ ] é™æ€ä¸­æ–­æ–­ç‚¹ï¼ˆinterrupt_before/afterï¼‰
- [ ] å­å›¾æµå¼è®¢é˜…
- [ ] Store API æŒä¹…åŒ–
- [ ] Run ç®¡ç†ï¼ˆå–æ¶ˆã€åˆ—è¡¨ï¼‰
- [ ] Double-texting ç­–ç•¥
- [ ] Cron å®šæ—¶ä»»åŠ¡

**è‹¥ä»»ä¸€é¡¹å‹¾é€‰ï¼Œåˆ™ä¸å»ºè®®è¿ç§»åˆ° A2Aã€‚**

---

## ä¸ƒã€ç»“è®ºä¸å»ºè®®

### 7.1 æ ¸å¿ƒç»“è®º

**A2A åè®®ç›®å‰æ— æ³•å®Œæ•´æ›¿ä»£ Thread API**

åŸå› ï¼š
1. **èƒ½åŠ›è¦†ç›–ä¸è¶³**ï¼šA2A ä»…æš´éœ² 3 ä¸ªæ–¹æ³•ï¼ŒThread API æä¾› 35+ ç«¯ç‚¹
2. **HITL èƒ½åŠ›ç¼ºå¤±**ï¼šæ— æ³•å®ç° interrupt_before/after ç²¾ç»†æ§åˆ¶
3. **çŠ¶æ€ä¸å¯è§**ï¼šæ— æ³•ä» Dify ä¾§è·å–æˆ–æ“ä½œ Agent çŠ¶æ€
4. **è®¾è®¡ç›®çš„ä¸åŒ**ï¼šA2A é¢å‘ Agent é—´åä½œï¼Œéå†…éƒ¨ç³»ç»Ÿé›†æˆ

### 7.2 å»ºè®®æ–¹æ¡ˆ

**çŸ­æœŸï¼ˆä¿æŒç°çŠ¶ï¼‰ï¼š**
```
ç»§ç»­ä½¿ç”¨ Thread API ä½œä¸º Difyâ†’LangGraph çš„ä¸»è¦æ¥å£
```
- ä¿æŒç°æœ‰èƒ½åŠ›ä¸å—å½±å“
- ç­‰å¾… A2A åè®®æˆç†Ÿå’ŒåŠŸèƒ½å®Œå–„

**ä¸­æœŸï¼ˆæ··åˆæ–¹æ¡ˆï¼‰ï¼š**
```
Thread APIï¼ˆå†…éƒ¨ï¼‰+ A2Aï¼ˆå¤–éƒ¨ï¼‰
```
- å¯¹å†…ï¼šDify é€šè¿‡ Thread API è°ƒç”¨è‡ªæœ‰ LangGraph Agent
- å¯¹å¤–ï¼šé€šè¿‡ A2A åè®®æš´éœ² Agent ä¾›å¤–éƒ¨ç³»ç»Ÿæ¥å…¥

**é•¿æœŸï¼ˆè§† A2A å‘å±•ï¼‰ï¼š**
```
å…³æ³¨ A2A åè®®æ¼”è¿›ï¼Œè¯„ä¼°æ˜¯å¦æ–°å¢çŠ¶æ€ç®¡ç†ã€HITL ç­‰ä¼ä¸šçº§ç‰¹æ€§
```

### 7.3 æœ€ç»ˆå»ºè®®

> **ä¸å»ºè®®åœ¨å½“å‰é˜¶æ®µå°† Dify çš„ LangGraph å¯¹æ¥ä» Thread API è¿ç§»åˆ° A2A åè®®**

ç†ç”±ï¼š
1. A2A è®¾è®¡ç›®æ ‡æ˜¯ Agent é—´äº’æ“ä½œï¼Œä¸æ˜¯æ›¿ä»£å†…éƒ¨ API
2. å…³é”®èƒ½åŠ›ï¼ˆHITLã€çŠ¶æ€ç®¡ç†ï¼‰åœ¨ A2A ä¸­ç¼ºå¤±
3. è¿ç§»æ”¶ç›Šï¼ˆæ ‡å‡†åŒ–ã€äº’æ“ä½œï¼‰åœ¨å½“å‰å†…éƒ¨ä½¿ç”¨åœºæ™¯ä¸‹ä»·å€¼æœ‰é™
4. å­˜åœ¨ä¸šåŠ¡åŠŸèƒ½é™çº§é£é™©

---

## å…«ã€ä¿¡æ¯æ¥æº

### å®˜æ–¹æ–‡æ¡£
- LangChain A2A æ–‡æ¡£: https://docs.langchain.com/langsmith/server-a2a
- LangGraph Platform API: https://langchain-ai.github.io/langgraph/cloud/reference/api/api_ref.html
- LangGraph HITL: https://docs.langchain.com/langsmith/add-human-in-the-loop
- LangGraph Streaming: https://docs.langchain.com/langsmith/streaming
- A2A åè®®è§„èŒƒ: https://a2a-protocol.org/latest/specification/

### ç¤¾åŒºå®ç°
- ruska-ai/a2a-langgraph: https://github.com/ruska-ai/a2a-langgraph
- llmx-de/a2a-template-langgraph: https://github.com/llmx-de/a2a-template-langgraph

### å‰åºè°ƒç ”
- A2A åè®®æ·±åº¦è°ƒç ”: [a2a-protocol-research.md](./a2a-protocol-research.md)
